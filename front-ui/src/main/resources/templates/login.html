<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–í—Ö–æ–¥</title>
    <meta charset="utf-8">
</head>
<body>
<a href="/signup" style="float:right;">
    <b>–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø &plus;</b>
</a>
<br>
<form onsubmit="fun(event)" method="post">
    <table style="width:30%;margin-left:auto;margin-right:auto;border-radius:2%;padding:10px;background-color:whitesmoke;">
        <tr>
            <td style="font-weight:bold;">–õ–æ–≥–∏–Ω</td>
            <td>
                <input name="login" id="login" type="text" style="width:100%" required/>
            </td>
        </tr>
        <tr>
            <td style="font-weight:bold;">–ü–∞—Ä–æ–ª—å</td>
            <td>
                <input name="password" id="password" type="password" style="width:100%" required/>
            </td>
        </tr>
        <tr>
            <td style="text-align:right" colspan="2">
                <button type="submit">–í–æ–π—Ç–∏</button>
            </td>
        </tr>
    </table>
</form>
<script>
    async function fun(event) {
        event.preventDefault();

        const login = document.getElementById('login').value;
        const password = document.getElementById('password').value;

        try {
            const response = await fetch('/account/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({login, password})
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();

            const {accessToken, refreshToken} = data.data;

            console.log('üîë –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω accessToken –ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å accessToken:', accessToken.substring(0, 20) + '...');
            console.log('üîÅ –£—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω refreshToken –ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å refreshToken:', refreshToken.substring(0, 20) + '...');

            document.cookie = `accessToken=${accessToken}; Path=/; Max-Age=86400; SameSite=Strict`;
            document.cookie = `refreshToken=${refreshToken}; Path=/; Max-Age=86400; SameSite=Strict`;

            window.location.href = '/main';

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);

            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
            document.querySelector('table').prepend(errorDiv);
        }
    }
</script>
</body>
</html>